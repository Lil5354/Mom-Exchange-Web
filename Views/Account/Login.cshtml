@using B_M.Models.ViewModels
@model object

@{
    ViewBag.Title = "Đăng nhập & Đăng ký";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var loginModel = Model as LoginViewModel ?? new LoginViewModel();
    var registerModel = Model as RegisterViewModel ?? new RegisterViewModel();
}

<link href="~/Content/account-style.css" rel="stylesheet" />

<div class="auth-page-wrapper">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert" style="max-width: 500px; margin: 20px auto; background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 8px;">
            <strong>Thành công!</strong> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert" style="max-width: 500px; margin: 20px auto; background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 8px;">
            <strong>Lỗi!</strong> @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
        </div>
    }

    <div class="container-auth @(ViewBag.ShowRegister == true ? "right-panel-active" : "")" id="container-auth">
        <div class="form-container sign-up-container">
            @using (Html.BeginForm("Register", "Account", FormMethod.Post, new { @class = "auth-form" }))
            {
                @Html.AntiForgeryToken()
                <h1>Tạo tài khoản</h1>
                <div class="social-container">
                    <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                    <button type="button" class="social" onclick="loginWithGoogle()" title="Đăng ký bằng Google">
                        <i class="fab fa-google"></i>
                    </button>
                </div>
                <span>hoặc sử dụng email của bạn để đăng ký</span>

                <input type="text" name="FullName" placeholder="Họ và tên" />
                @Html.ValidationMessage("FullName", "", new { @class = "text-danger" })
                
                <input type="email" name="Email" placeholder="Email" />
                @Html.ValidationMessage("Email", "", new { @class = "text-danger" })
                
                <input type="text" name="PhoneNumber" placeholder="Số điện thoại (không bắt buộc)" />
                @Html.ValidationMessage("PhoneNumber", "", new { @class = "text-danger" })
                
                <input type="password" name="Password" placeholder="Mật khẩu" />
                @Html.ValidationMessage("Password", "", new { @class = "text-danger" })
                
                <input type="password" name="ConfirmPassword" placeholder="Xác nhận mật khẩu" />
                @Html.ValidationMessage("ConfirmPassword", "", new { @class = "text-danger" })
                
                <button class="auth-button" type="submit">Đăng Ký</button>
            }
        </div>

        <div class="form-container sign-in-container">
            @using (Html.BeginForm("Login", "Account", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @class = "auth-form" }))
            {
                @Html.AntiForgeryToken()
                <h1>Đăng Nhập</h1>
                <div class="social-container">
                    <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                    <button type="button" class="social" onclick="loginWithGoogle()" title="Đăng nhập bằng Google">
                        <i class="fab fa-google"></i>
                    </button>
                </div>
                <span>hoặc sử dụng tài khoản của bạn</span>

                <input type="text" name="EmailOrUsername" placeholder="Email" />
                @Html.ValidationMessage("EmailOrUsername", "", new { @class = "text-danger" })
                
                <input type="password" name="Password" placeholder="Mật khẩu" />
                @Html.ValidationMessage("Password", "", new { @class = "text-danger" })
                
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin: 15px 0 10px 0;">
                    <label style="display: flex; align-items: center; gap: 8px; margin: 0; cursor: pointer; font-size: 14px;">
                        @Html.CheckBox("RememberMe", loginModel.RememberMe, new { style = "cursor: pointer;" })
                        <span>Ghi nhớ tôi</span>
                    </label>
                    <a href="#" style="font-size: 14px;">Quên mật khẩu?</a>
                </div>
                <button class="auth-button" type="submit">Đăng Nhập</button>
            }
        </div>

        <div class="overlay-container">
            <div class="overlay">
                <div class="overlay-panel overlay-left">
                    <h1>Chào mừng trở lại!</h1>
                    <p>Để giữ kết nối với cộng đồng, vui lòng đăng nhập bằng thông tin cá nhân của bạn</p>
                    <button class="auth-button ghost" id="signIn">Đăng Nhập</button>
                </div>
                <div class="overlay-panel overlay-right">
                    <h1>Chào bạn!</h1>
                    <p>Nhập thông tin cá nhân của bạn và bắt đầu hành trình cùng chúng tôi</p>
                    <button class="auth-button ghost" id="signUp">Đăng Ký</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden form for Google OAuth -->
<form id="googleLoginForm" action="@Url.Action("ExternalLogin", "Account")" method="post" style="display: none;">
    <input type="hidden" name="provider" value="Google" />
    <input type="hidden" name="returnUrl" value="@ViewBag.ReturnUrl" />
</form>

@section scripts {
    <script>
        const signUpButton = document.getElementById('signUp');
        const signInButton = document.getElementById('signIn');
        const container = document.getElementById('container-auth');

        signUpButton.addEventListener('click', () => {
            container.classList.add("right-panel-active");
        });

        signInButton.addEventListener('click', () => {
            container.classList.remove("right-panel-active");
        });

        // Google OAuth login function
        function loginWithGoogle() {
            console.log('Google login clicked');
            document.getElementById('googleLoginForm').submit();
        }
    </script>
}