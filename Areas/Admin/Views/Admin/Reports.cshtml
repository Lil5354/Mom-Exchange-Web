@model B_M.Models.AdminDashboardViewModel
@{
    ViewBag.Title = "Báo cáo";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<!-- Statistics Overview -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-users"></i>
        </div>
        <div class="stat-number">@Model.TotalUsers</div>
        <div class="stat-label">Tổng người dùng</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-user-check"></i>
        </div>
        <div class="stat-number">@Model.ActiveUsers</div>
        <div class="stat-label">Người dùng hoạt động</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-crown"></i>
        </div>
        <div class="stat-number">@Model.AdminUsers</div>
        <div class="stat-label">Quản trị viên</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-baby"></i>
        </div>
        <div class="stat-number">@Model.MomUsers</div>
        <div class="stat-label">Mẹ bỉm</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-store"></i>
        </div>
        <div class="stat-number">@Model.BrandUsers</div>
        <div class="stat-label">Nhãn hàng</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-user-plus"></i>
        </div>
        <div class="stat-number">@Model.NewUsersThisMonth</div>
        <div class="stat-label">Người dùng mới tháng này</div>
    </div>
</div>

<!-- Main Reports Content -->
<div class="admin-card">
    <div class="admin-card-header">
        <h5><i class="fas fa-chart-bar"></i> Báo cáo thống kê</h5>
        <div style="display: flex; gap: 10px; align-items: center;">
            <button id="refreshReports" class="btn-admin-secondary" style="padding: 8px 16px;">
                <i class="fas fa-sync-alt"></i> Làm mới
            </button>
            <span style="color: #7f8c8d; font-size: 14px;">
                Cập nhật lần cuối: @DateTime.Now.ToString("dd/MM/yyyy HH:mm")
            </span>
        </div>
    </div>
    <div class="admin-card-body">
        <!-- User Growth Chart -->
        <div class="admin-card" style="margin-bottom: 25px;">
            <div class="admin-card-header">
                <h6><i class="fas fa-chart-line"></i> Biểu đồ tăng trưởng người dùng</h6>
            </div>
            <div class="admin-card-body">
                <div id="userGrowthChart" style="height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #6c757d;">
                    <div style="text-align: center;">
                        <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Biểu đồ sẽ được hiển thị ở đây</p>
                        <small>Chức năng biểu đồ đang được phát triển</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Distribution -->
        <div class="admin-card" style="margin-bottom: 25px;">
            <div class="admin-card-header">
                <h6><i class="fas fa-pie-chart"></i> Phân bố người dùng theo vai trò</h6>
            </div>
            <div class="admin-card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border-radius: 12px;">
                        <div style="font-size: 36px; font-weight: 700; color: #1976d2;">@Model.AdminUsers</div>
                        <div style="color: #1976d2; font-weight: 600;">Quản trị viên</div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            @if (Model.TotalUsers > 0)
                            {
                                @Math.Round((double)Model.AdminUsers / Model.TotalUsers * 100, 1)@:%
                            }
                            else
                            {
                                <text>0%</text>
                            }
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #fff3e0, #fce4ec); border-radius: 12px;">
                        <div style="font-size: 36px; font-weight: 700; color: #f57c00;">@Model.MomUsers</div>
                        <div style="color: #f57c00; font-weight: 600;">Mẹ bỉm</div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            @if (Model.TotalUsers > 0)
                            {
                                @Math.Round((double)Model.MomUsers / Model.TotalUsers * 100, 1)@:%
                            }
                            else
                            {
                                <text>0%</text>
                            }
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #e8f5e8, #f1f8e9); border-radius: 12px;">
                        <div style="font-size: 36px; font-weight: 700; color: #388e3c;">@Model.BrandUsers</div>
                        <div style="color: #388e3c; font-weight: 600;">Nhãn hàng</div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            @if (Model.TotalUsers > 0)
                            {
                                @Math.Round((double)Model.BrandUsers / Model.TotalUsers * 100, 1)@:%
                            }
                            else
                            {
                                <text>0%</text>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Users -->
        @if (Model.RecentUsers.Any())
        {
            <div class="admin-card">
                <div class="admin-card-header">
                    <h6><i class="fas fa-user-clock"></i> Người dùng mới nhất</h6>
                </div>
                <div class="admin-card-body">
                    <div class="table-responsive">
                        <table class="table-admin">
                            <thead>
                                <tr>
                                    <th>Thông tin</th>
                                    <th>Email</th>
                                    <th>Vai trò</th>
                                    <th>Trạng thái</th>
                                    <th>Ngày tạo</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var user in Model.RecentUsers)
                                {
                                    <tr>
                                        <td>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #e74c3c, #c0392b); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
                                                    @(user.UserDetails?.FullName?.Substring(0, 1).ToUpper() ?? "U")
                                                </div>
                                                <div>
                                                    <div style="font-weight: 600; color: #2c3e50;">@(user.UserDetails?.FullName ?? "Chưa cập nhật")</div>
                                                    <div style="font-size: 12px; color: #7f8c8d;">@(user.UserName ?? "Không có tên đăng nhập")</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td>@user.Email</td>
                                        <td>
                                            @{
                                                string roleName = "";
                                                string roleClass = "";
                                                switch (user.Role)
                                                {
                                                    case 1:
                                                        roleName = "Quản trị viên";
                                                        roleClass = "badge-danger";
                                                        break;
                                                    case 2:
                                                        roleName = "Mẹ bỉm";
                                                        roleClass = "badge-warning";
                                                        break;
                                                    case 3:
                                                        roleName = "Nhãn hàng";
                                                        roleClass = "badge-info";
                                                        break;
                                                    default:
                                                        roleName = "Không xác định";
                                                        roleClass = "badge-secondary";
                                                        break;
                                                }
                                            }
                                            <span class="badge @roleClass">@roleName</span>
                                        </td>
                                        <td>
                                            @if (user.IsActive)
                                            {
                                                <span class="badge badge-success">Hoạt động</span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-danger">Bị khóa</span>
                                            }
                                        </td>
                                        <td>@user.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="admin-card">
                <div class="admin-card-header">
                    <h6><i class="fas fa-user-clock"></i> Người dùng mới nhất</h6>
                </div>
                <div class="admin-card-body">
                    <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                        <i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Chưa có người dùng nào</p>
                    </div>
                </div>
            </div>
        }

        <!-- System Status -->
        <div class="admin-card">
            <div class="admin-card-header">
                <h6><i class="fas fa-server"></i> Trạng thái hệ thống</h6>
            </div>
            <div class="admin-card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #28a745;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="status-indicator active"></div>
                            <div>
                                <div style="font-weight: 600; color: #28a745;">Hệ thống hoạt động</div>
                                <div style="font-size: 12px; color: #666;">Tất cả dịch vụ đang chạy bình thường</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #17a2b8;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="status-indicator active"></div>
                            <div>
                                <div style="font-weight: 600; color: #17a2b8;">Cơ sở dữ liệu</div>
                                <div style="font-size: 12px; color: #666;">Kết nối ổn định</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #ffc107;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="status-indicator warning"></div>
                            <div>
                                <div style="font-weight: 600; color: #ffc107;">Bộ nhớ</div>
                                <div style="font-size: 12px; color: #666;">Sử dụng 75% dung lượng</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            // Refresh reports functionality
            $('#refreshReports').on('click', function() {
                var button = $(this);
                var originalText = button.html();
                
                // Show loading state
                button.html('<i class="fas fa-spinner fa-spin"></i> Đang tải...');
                button.prop('disabled', true);
                
                // Simulate refresh (in real implementation, this would make an AJAX call)
                setTimeout(function() {
                    button.html(originalText);
                    button.prop('disabled', false);
                    
                    // Update timestamp
                    var now = new Date();
                    var timeString = now.toLocaleDateString('vi-VN') + ' ' + now.toLocaleTimeString('vi-VN');
                    $('span:contains("Cập nhật lần cuối")').text('Cập nhật lần cuối: ' + timeString);
                    
                    showAlert('success', 'Báo cáo đã được làm mới thành công!');
                }, 1500);
            });

            // Initialize charts (placeholder for future implementation)
            initializeCharts();
        });

        function initializeCharts() {
            // Placeholder for chart initialization
            // In the future, this could integrate with Chart.js or similar libraries
            console.log('Charts initialization placeholder');
        }

        function showAlert(type, message) {
            var alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            var alertHtml = '<div class="alert ' + alertClass + ' alert-dismissible fade show" role="alert" style="margin-bottom: 20px;">' +
                '<strong>' + (type === 'success' ? 'Thành công!' : 'Lỗi!') + '</strong> ' + message +
                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>' +
                '</div>';
            
            $('.admin-content').prepend(alertHtml);
            
            // Auto-hide after 5 seconds
            setTimeout(function() {
                $('.alert').fadeOut();
            }, 5000);
        }
    </script>
}
